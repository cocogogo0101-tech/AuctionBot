# ๐ฅ AuctionBot - ุงูุณูุงุก ุงูุฌููุจูุฉ

ุจูุช ุฏูุณููุฑุฏ ุงุญุชุฑุงูู ูุฅุฏุงุฑุฉ ุงููุฒุงุฏุงุช ูุน ูุงุนุฏุฉ ุจูุงูุงุช PostgreSQL/Supabase
**๐ก๏ธ ูุน ูุธุงู Self-Healing ูุจุฑูุชููููุงุช ุงูุฃูุงู ุงููุชูุฏูุฉ**

## โจ ุงููููุฒุงุช

### ๐ฏ ุงููููุฒุงุช ุงูุฃุณุงุณูุฉ
- โ ุฅูุดุงุก ูุฒุงุฏุงุช ุชูุงุนููุฉ ุจุฃุฒุฑุงุฑ
- โ ูุฒุงูุฏุฉ ุณุฑูุนุฉ (+) ุฃู ูุจูุบ ูุฎุตุต
- โ ูุธุงู ุตูุงุญูุงุช (ุฑุชุจุฉ ุฑูุงุฏ ุงููุฒุงุฏ)
- โ ุชุณุฌูู ุชูุตููู ููู ูุฒุงุฏ
- โ ุฏุนู ุชูุณูู ุงูุฃุฑูุงู (k, m)
- โ ุญูุธ ูู ุดูุก ูู ูุงุนุฏุฉ ุจูุงูุงุช

### ๐ ุงูุชุญุฏูุซุงุช ุงูุฌุฏูุฏุฉ
- ๐ **ูุธุงู ุฅูุบุงุก ุงููุฒุงุฏ**: ุฅููุงููุฉ ุฅูุบุงุก ุงููุฒุงุฏุงุช ุงููุดุทุฉ ูู ูุจู ุงูุฅุฏุงุฑุฉ
- ๐ **ุณุฌู ุงููุฒุงุฏุงุช**: ุนุฑุถ ุงููุฒุงุฏุงุช ุงูุณุงุจูุฉ ูุน ุชูุงุตูููุง
- ๐ฅ **ุชุตุฏูุฑ ุงูุจูุงูุงุช**: ุชุตุฏูุฑ ุจูุงูุงุช ุงููุฒุงุฏุงุช ูููู CSV
- ๐ **ุญูุงูุฉ ุงูุณูุฑูุฑ**: ุชูููุฏ ุงูุจูุช ุนูู ุณูุฑูุฑ ูุงุญุฏ ููุท (Guild ID Lock)

### ๐ก๏ธ ูุธุงู Self-Healing (ุฌุฏูุฏ!)
- ๐ **ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุงูุชููุงุฆู**: ูุนูุฏ ุงูุงุชุตุงู ุชููุงุฆูุงู ุนูุฏ ูุทุน ุงูุงุชุตุงู
- โก **Exponential Backoff**: ูุธุงู ุฐูู ูุฅุนุงุฏุฉ ุงููุญุงููุฉ
- ๐ **ุชุชุจุน ุงูุฃุฎุทุงุก**: ูุฑุงูุจุฉ ูุชุณุฌูู ุฌููุน ุงูุฃุฎุทุงุก
- ๐ **Logging ูุญุณูู**: ุณุฌูุงุช ููุตูุฉ ูุชุดุฎูุต ุงููุดุงูู
- ๐ช **Error Recovery**: ูุนุงูุฌุฉ ุฐููุฉ ููุฃุฎุทุงุก
- ๐ **Rate Limit Handling**: ุงูุชุนุงูู ุงูุฐูู ูุน ุญุฏูุฏ Discord
- ๐ **Security Hardening**: ุญูุงูุฉ ุถุฏ ุงููุฌูุงุช ูุงูุฃุฎุทุงุก

---

## ๐ก๏ธ ูุธุงู Self-Healing ุงููุชูุฏู

### ููู ูุนููุ

ุงูุจูุช ุงูุขู ูุญุชูู ุนูู ูุธุงู ุฐูู ูุฅุตูุงุญ ููุณู ุชููุงุฆูุงู ุนูุฏ ุญุฏูุซ ุฃุฎุทุงุก:

#### 1๏ธโฃ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุชููุงุฆูุฉ**
```
โ ุฎุทุฃ ูู ุงูุงุชุตุงู โ โณ ุงูุชุธุงุฑ โ ๐ ุฅุนุงุฏุฉ ูุญุงููุฉ
```

#### 2๏ธโฃ **Exponential Backoff**
- ุงููุญุงููุฉ ุงูุฃููู: ุงูุชุธุงุฑ 5 ุซูุงู
- ุงููุญุงููุฉ ุงูุซุงููุฉ: ุงูุชุธุงุฑ 10 ุซูุงู
- ุงููุญุงููุฉ ุงูุซุงูุซุฉ: ุงูุชุธุงุฑ 20 ุซุงููุฉ
- ูููุฐุง... (ุญุชู 5 ุฏูุงุฆู ูุญุฏ ุฃูุตู)

#### 3๏ธโฃ **ุฃููุงุน ุงูุฃุฎุทุงุก ุงููุฏุนููุฉ**

| ููุน ุงูุฎุทุฃ | ุงูุงุณุชุฌุงุจุฉ |
|-----------|-----------|
| Rate Limiting (429) | ุงูุชุธุงุฑ ุฐูู ุซู ุฅุนุงุฏุฉ ูุญุงููุฉ |
| Server Error (502-504) | ุฅุนุงุฏุฉ ูุญุงููุฉ ูุน ุชุฃุฎูุฑ |
| Connection Lost | ุฅุนุงุฏุฉ ุงุชุตุงู ุชููุงุฆู |
| Database Error | ูุญุงููุฉ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุจู DB |
| Unknown Error | ุชุณุฌูู ูุฅุนุงุฏุฉ ูุญุงููุฉ |

#### 4๏ธโฃ **ุญุฏูุฏ ุงูุฃูุงู**
- โ ุญุฏ ุฃูุตู **5 ูุญุงููุงุช** ูุฅุนุงุฏุฉ ุงูุงุชุตุงู
- โ ุฅููุงู ุชููุงุฆู ุฅุฐุง ูุงู ุงูู Token ุฎุงุทุฆ
- โ ุชุณุฌูู ููุตู ููู ุงูุฃุฎุทุงุก

### ๐ ุชุชุจุน ุงูุฃุฎุทุงุก

ุงูุจูุช ูุญุชูุธ ุจุฅุญุตุงุฆูุงุช ุนู:
- ุนุฏุฏ ุงูุฃุฎุทุงุก ุงููุชุชุงููุฉ
- ุฅุฌูุงูู ุงูุฃุฎุทุงุก ููุฐ ุงูุชุดุบูู
- ููุช ุขุฎุฑ ุฎุทุฃ
- ููุน ุงูุฃุฎุทุงุก

### ๐ Logging ุงููุญุณูู

ุฌููุน ุงูุฃุญุฏุงุซ ูุชู ุชุณุฌูููุง ูู:
- **Console**: ูููุฑุงูุจุฉ ุงููุจุงุดุฑุฉ
- **bot.log**: ููู ุณุฌู ุฏุงุฆู

**ุฃูุซูุฉ ุนูู ุงูุฑุณุงุฆู:**
```
โ Bot is ready and operational!
โ๏ธ Rate limited by Discord! Waiting...
๐ Attempting to restart...
โ Critical error detected
```

---

## ๐ ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

### 1๏ธโฃ ุชุซุจูุช ุงูููุชุจุงุช
```bash
pip install -r requirements.txt
```

### 2๏ธโฃ ุฅุนุฏุงุฏ ููู `.env`
ุงูุณุฎ ููู `.env.example` ุฅูู `.env` ูุนุฏูู ุงูููู:

```env
# Discord Bot Token
DISCORD_TOKEN=your_discord_bot_token_here

# Database Connection String
DATA=postgresql://user:password@host:port/database

# ๐ Guild ID Lock (ุงุฎุชูุงุฑู)
ALLOWED_GUILD_ID=1234567890
```

โ๏ธ **ููู ุฌุฏุงู:**
- ูุง ุชุถุน ูุณุงูุงุช ูุจู ุฃู ุจุนุฏ ุงูููู
- ูุง ุชุณุชุฎุฏู ุนูุงูุงุช ุงูุชุจุงุณ
- ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุณุทุฑ ูุงุฑุบุฉ

### 3๏ธโฃ ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
ุงูุจูุช ุณููุดุฆ ุงูุฌุฏุงูู ุชููุงุฆูุงู ุนูุฏ ุงูุชุดุบูู ุงูุฃูู:
- `auctions` - ุฌุฏูู ุงููุฒุงุฏุงุช
- `bids` - ุฌุฏูู ุงููุฒุงูุฏุงุช
- `settings` - ุฌุฏูู ุงูุฅุนุฏุงุฏุงุช

### 4๏ธโฃ ุชุดุบูู ุงูุจูุช
```bash
python bot.py
```

---

## ๐ง ุงูุฅุนุฏุงุฏุงุช

### ุชูููู ุงูุณูุฑูุฑ
ุงุณุชุฎุฏู ุงูุฃูุงูุฑ ุงูุชุงููุฉ ูุฅุนุฏุงุฏ ุงูุจูุช:

```
/set_auction_role @ุฑุชุจุฉ_ุงูุฑูุงุฏ
/set_auction_channel #ููุงุฉ_ุงููุฒุงุฏุงุช
/set_log_channel #ููุงุฉ_ุงูููู
/set_emoji fire ๐ฅ
```

### ๐ ูุธุงู ุญูุงูุฉ ุงูุณูุฑูุฑ (Guild ID Lock)

ูุชูุนูู ุงูุญูุงูุฉุ ุฃุถู `ALLOWED_GUILD_ID` ูู ููู `.env`:

```env
ALLOWED_GUILD_ID=1234567890
```

**ููู ูุนูู:**
- โ ุงูุจูุช ุณูุนูู ููุท ูู ุงูุณูุฑูุฑ ุงููุญุฏุฏ
- ๐ซ ุฅุฐุง ุชูุช ุฅุถุงูุชู ูุณูุฑูุฑ ุขุฎุฑุ ุณูุฎุฑุฌ ุชููุงุฆูุงู
- ๐งน ุนูุฏ ุงูุชุดุบููุ ุณูุฎุฑุฌ ูู ุฌููุน ุงูุณูุฑูุฑุงุช ุบูุฑ ุงููุตุฑุญ ุจูุง
- ๐จ ูุฑุณู ุฑุณุงูุฉ ุชูุถูุญูุฉ ูุจู ุงููุบุงุฏุฑุฉ

**ูุชุนุทูู ุงูุญูุงูุฉ:**
- ุงุญุฐู ุงูุณุทุฑ ุฃู ุงุชุฑูู ูุงุฑุบุงู ูู ููู `.env`

---

## ๐ ุงูุฃูุงูุฑ

### ุฃูุงูุฑ ุงููุฒุงุฏุงุช

#### `/ููุญุฉ_ูุฒุงุฏ`
ุฅูุดุงุก ููุญุฉ ูุฒุงูุฏุฉ ุฌุฏูุฏุฉ (ุฅุฏุงุฑุฉ ููุท)

**ุงููุนุงููุงุช:**
- `start`: ุณุนุฑ ุงูุจุฏุงูุฉ (ูุซุงู: 500k ุฃู 1m)
- `min_inc`: ุฃูู ุฒูุงุฏุฉ (ูุซุงู: 50k)
- `duration`: ูุฏุฉ ุงููุฒุงุฏ ุจุงูุฏูุงุฆู
- `channel`: ููุงุฉ ุงููุฒุงุฏ (ุงุฎุชูุงุฑู)

**ูุซุงู:**
```
/ููุญุฉ_ูุฒุงุฏ start:1m min_inc:100k duration:30
```

#### `/ุฅูุบุงุก_ูุฒุงุฏ` ๐
ุฅูุบุงุก ูุฒุงุฏ ูุดุท (ุฅุฏุงุฑุฉ ููุท)

**ุงููุนุงููุงุช:**
- `message_id`: ID ุฑุณุงูุฉ ุงููุฒุงุฏ

**ูุซุงู:**
```
/ุฅูุบุงุก_ูุฒุงุฏ message_id:1234567890
```

**ุงูุญุตูู ุนูู ID ุงูุฑุณุงูุฉ:**
1. ุงููุฑ ุจุฒุฑ ุงููุฃุฑุฉ ุงูุฃููู ุนูู ุฑุณุงูุฉ ุงููุฒุงุฏ
2. ุงุฎุชุฑ "ูุณุฎ ูุนุฑู ุงูุฑุณุงูุฉ"
3. (ุชุฃูุฏ ูู ุชูุนูู ูุถุน ุงููุทูุฑ ูู ุฅุนุฏุงุฏุงุช Discord)

#### `/ุณุฌู_ุงููุฒุงุฏุงุช` ๐
ุนุฑุถ ุงููุฒุงุฏุงุช ุงูุณุงุจูุฉ

**ุงููุนุงููุงุช:**
- `limit`: ุนุฏุฏ ุงููุฒุงุฏุงุช (ุงูุชุฑุงุถู: 10ุ ุงูุญุฏ ุงูุฃูุตู: 50)

**ูุซุงู:**
```
/ุณุฌู_ุงููุฒุงุฏุงุช limit:20
```

#### `/ุชุตุฏูุฑ_ูุฒุงุฏุงุช` ๐
ุชุตุฏูุฑ ุจูุงูุงุช ุงููุฒุงุฏุงุช ูููู CSV (ุฅุฏุงุฑุฉ ููุท)

**ุงููุนุงููุงุช:**
- `limit`: ุนุฏุฏ ุงููุฒุงุฏุงุช (ุงูุชุฑุงุถู: 100ุ ุงูุญุฏ ุงูุฃูุตู: 500)

**ูุซุงู:**
```
/ุชุตุฏูุฑ_ูุฒุงุฏุงุช limit:200
```

**ุงูุจูุงูุงุช ุงููุตุฏุฑุฉ:**
- Auction ID
- Started At
- Ended At
- Duration (minutes)
- Start Price
- Final Price
- Winner ID
- Winner Username
- Creator ID
- Total Bids
- Status (Completed/Cancelled/No Sale)

### ุฃูุงูุฑ ุงูุฅุนุฏุงุฏุงุช

#### `/set_auction_role`
ุชุญุฏูุฏ ุฑุชุจุฉ ุฑูุงุฏ ุงููุฒุงุฏ (ุฅุฏุงุฑุฉ ููุท)

#### `/set_auction_channel`
ุชุญุฏูุฏ ููุงุฉ ุงููุฒุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ (ุฅุฏุงุฑุฉ ููุท)

#### `/set_log_channel`
ุชุญุฏูุฏ ููุงุฉ ุงูููู ูููุฒุงุฏุงุช (ุฅุฏุงุฑุฉ ููุท)

#### `/set_emoji`
ุชุนููู ุฅูููุฌู ูุฎุตุต (ุฅุฏุงุฑุฉ ููุท)

**ุงูุฃููุงุน ุงููุชุงุญุฉ:**
- `fire` ๐ฅ
- `crown` ๐
- `time` โณ
- `money` ๐ฐ

---

## ๐พ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู auctions
```sql
id               SERIAL PRIMARY KEY
guild_id         BIGINT
channel_id       BIGINT
message_id       BIGINT
start_price      BIGINT
current_price    BIGINT
min_increase     BIGINT
created_by       BIGINT
started_at       TIMESTAMP WITH TIME ZONE
ended_at         TIMESTAMP WITH TIME ZONE
winner_id        BIGINT
ended            BOOLEAN
cancelled        BOOLEAN  -- ๐
```

### ุฌุฏูู bids
```sql
id               SERIAL PRIMARY KEY
auction_id       INTEGER (FK -> auctions.id)
user_id          BIGINT
amount           BIGINT
created_at       TIMESTAMP WITH TIME ZONE
```

### ุฌุฏูู settings
```sql
key              TEXT PRIMARY KEY
value            TEXT
```

---

## ๐จ ุงูุชุฎุตูุต

### ููู `config.json`
```json
{
  "auction_role_id": 0,
  "auction_channel_id": 0,
  "auction_log_channel": 0,
  "commission_percent": 20,
  "emojis": {
    "fire": "๐ฅ",
    "crown": "๐",
    "time": "โณ",
    "money": "๐ฐ"
  }
}
```

ููููู ุชุนุฏูู:
- ุงูุฅูููุฌูุงุช ุงููุณุชุฎุฏูุฉ
- ูุณุจุฉ ุงูุนูููุฉ (ููุงุณุชุฎุฏุงู ุงููุณุชูุจูู)
- ุงููููุงุช ูุงูุฑุชุจ ุงูุงูุชุฑุงุถูุฉ

---

## ๐ ุญุงูุงุช ุงููุฒุงุฏ

### โ ููุชูู (Completed)
- ุงููุฒุงุฏ ุงูุชูู ุจูุงุฆุฒ
- ุชู ุญูุธ ุงููุงุฆุฒ ูุงูุณุนุฑ ุงูููุงุฆู

### ๐ซ ููุบู (Cancelled)
- ุชู ุฅูุบุงุคู ูู ูุจู ุงูุฅุฏุงุฑุฉ
- ูุชู ุญูุธ ุขุฎุฑ ุณุนุฑ ููุฒุงูุฏ
- ูุง ูุนุชุจุฑ ููุฒุงู ูููุฒุงูุฏ ุงูุฃุฎูุฑ

### โ ูู ูุชู ุงูุจูุน (No Sale)
- ุงููุฒุงุฏ ุงูุชูู ุจุฏูู ุฃู ูุฒุงูุฏุงุช
- ูุง ููุฌุฏ ูุงุฆุฒ

---

## ๐ ุชูุณูู ุงูุฃุฑูุงู

ุงูุจูุช ูุฏุนู ุชูุณูู ุงูุฃุฑูุงู ุจุดูู ุฐูู:

**ุงูุฅุฏุฎุงู:**
- `1000000` ุฃู `1m` โ 1 ููููู
- `500000` ุฃู `500k` โ 500 ุฃูู
- `1500` โ 1,500

**ุงูุนุฑุถ:**
- `1000000` โ 1m
- `500000` โ 500k
- `1500` โ 1.5k

---

## ๐๏ธ ุงููููุงุช

```
โโโ bot.py              # ุงูููู ุงูุฑุฆูุณู
โโโ db.py               # ุทุจูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
โโโ web.py              # ุฎุงุฏู Flask ููู keep-alive
โโโ config.json         # ููู ุงูุฅุนุฏุงุฏุงุช
โโโ requirements.txt    # ุงูููุชุจุงุช ุงููุทููุจุฉ
โโโ .env               # ูุชุบูุฑุงุช ุงูุจูุฆุฉ (ูุง ุชุดุงุฑูู!)
โโโ .env.example       # ูุซุงู ูููู ุงูุจูุฆุฉ
```

---

## ๐ ุงูุฃูุงู

### ูุตุงุฆุญ ุงูุฃูุงู:
1. โ **ูุง ุชุดุงุฑู** ููู `.env` ุฃุจุฏุงู
2. โ ุงุณุชุฎุฏู **ALLOWED_GUILD_ID** ูุชูููุฏ ุงูุจูุช
3. โ ุงููุญ ุตูุงุญูุงุช ุงูุฅุฏุงุฑุฉ **ููุท ููููุซูููู**
4. โ ุงุญูุธ **ูุณุฎุฉ ุงุญุชูุงุทูุฉ** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
5. โ ุฑุงูุจ **ูููุงุช ุงููุฒุงุฏุงุช** ุจุงูุชุธุงู

---

## ๐ ุญู ุงููุดุงูู

### ๐ฅ Cloudflare Error 1015 (Rate Limiting)

**ุงููุดููุฉ:** Discord ูุญุธุฑ IP ุงูุฎุงุต ุจู Render

**โ ุงูุญููู:**

1. **ุชุบููุฑ Region ูู Render:**
   - Dashboard โ Settings โ Region
   - ุฌุฑุจ ููุทูุฉ ุฃุฎุฑู (EU ุจุฏูุงู ูู US)

2. **ุงุณุชุฎุฏุงู VPS:**
   - DigitalOcean / Linode / Hetzner
   - IP ูุฎุตุต = ูุง rate limiting

3. **ุงูุชุธุฑ:**
   - ุงูุจูุช ุงูุขู ูุนูุฏ ุงููุญุงููุฉ ุชููุงุฆูุงู
   - ุฑุงูุจ ุงูู logs

**ููุชูุงุตูู:** ุดูู `TROUBLESHOOTING.md`

### โ๏ธ ValueError: Newline detected

**ุงููุดููุฉ:** ูุณุงูุงุช ูู DISCORD_TOKEN

**โ ุงูุญู:**
- ูู Render Environment Variables
- ุงุญุฐู ุงููุณุงูุงุช ูุงูุฃุณุทุฑ ุงูุฌุฏูุฏุฉ
- ูุง ุชุณุชุฎุฏู ุนูุงูุงุช ุงูุชุจุงุณ

### โ Database Connection Failed

**โ ุงูุญู:**
1. ุชุญูู ูู `DATA` ูู Environment
2. ุชุฃูุฏ ูู ุตุญุฉ Connection String
3. ูู Supabase: ุงุณุชุฎุฏู Session mode

### ๐ Logs ูู Render

ุฑุงูุจ ุงูู logs ุจุญุซุงู ุนู:
```
โ Bot is ready!          # ุชุดุบูู ูุงุฌุญ
โ๏ธ Rate limited          # ูุดููุฉ Rate limit
๐ Attempting to restart # ุฅุนุงุฏุฉ ูุญุงููุฉ
โ Critical error        # ุฎุทุฃ ุฎุทูุฑ
```

---

## ๐ ุงูุชูุซูู ุงูุฅุถุงูู

- **[TROUBLESHOOTING.md](TROUBLESHOOTING.md)** - ุฏููู ุญู ุงููุดุงูู ุงูุดุงูู
- **[CHANGELOG.md](CHANGELOG.md)** - ุณุฌู ุงูุชุญุฏูุซุงุช
- **security_config.json** - ุฅุนุฏุงุฏุงุช ุงูุฃูุงู ุงููุชูุฏูุฉ

---

## ๐ ุงูุฃูุงู
